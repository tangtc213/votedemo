{"version":3,"sources":["Login.jsx","url.js","Create.jsx","My.js","Home.jsx","CreateVote.js","ViewVote.jsx","Register.jsx","App.js","serviceWorker.js","index.js"],"names":["Login","props","usernameRef","useRef","passwordRef","history","useHistory","e","a","preventDefault","data","name","current","value","password","axios","post","res","code","setUserInfo","push","alert","response","msg","toString","useEffect","userInfo","className","onSubmit","ref","type","to","Url","Create","src","url","alt","My","localStorage","window","useState","myVotes","setMyVotes","voteId","get","getVotes","map","vote","idx","isOverdue","Date","deadline","now","key","id","title","style","color","fontSize","userId","onClick","deleteMyvote","then","clear","Home","useRouteMatch","path","exact","activeClassName","CreateVote","query","URLSearchParams","useLocation","search","options","useArray","useInput","desc","anonymous","useBoolean","isMultiple","toISOString","goBack","onChange","placeholder","it","length","removeIndex","setTrue","handleDeleteOption","setValue","slice","target","setFalse","toggle","checked","ViewVote","wsUrl","replace","useParams","loading","setLoading","voteInfo","setVoteInfo","groupedVotings","groupBy","votings","uniqueUsersCount","Set","size","optionId","hasVoted","getTime","Axios","isVoteDown","calPCT","divisor","dividend","toFixed","fetchData","ws","WebSocket","onmessage","JSON","parse","close","ShareAltOutlined","option","currVotings","hasCurrentVote","find","voteUp","content","width","voting","avatar","toLocaleString","setCurrentUsername","currentUsername","App","undefined","console","log","user","Register","Boolean","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.d5271221.chunk.js","sourcesContent":["import React, { useRef, useEffect, useState } from 'react'\r\nimport { useHistory } from 'react-router-dom'\r\nimport axios from 'axios'\r\nimport {\r\n    BrowserRouter as Router,\r\n    Link,\r\n  } from \"react-router-dom\";\r\nimport './Login.scss'\r\n\r\n\r\nexport default function Login(props) {\r\n\r\n\r\n\r\n    // const mystorage = window.localStorage\r\n    // const [currentUsername, setCurrentUsername] = useState('')\r\n    // useEffect(()=> {\r\n    //     var localUserInfo = mystorage.userInfo ? JSON.parse(mystorage.userInfo): ''\r\n    //     setCurrentUsername(localUserInfo.username)\r\n    // },[currentUsername])\r\n    const usernameRef = useRef()\r\n    const passwordRef = useRef()\r\n    // const captchaRef = useRef()\r\n    const history = useHistory()\r\n\r\n    useEffect(() => {\r\n        if (props.userInfo) {\r\n            history.push('/home')\r\n        }\r\n    },[])\r\n\r\n\r\n    async function submit(e) {\r\n        e.preventDefault()\r\n        var data = {\r\n            name: usernameRef.current.value,\r\n            password: passwordRef.current.value,\r\n            // captcha: captchaRef.current.value,\r\n        }\r\n        try {\r\n            var res = await axios.post('/login', data)\r\n            if (res.data.code != -1) {\r\n                // console.log(res.data)\r\n                props.setUserInfo(res.data)\r\n                // props.onLogin && props.onLogin(res.data)\r\n                // mystorage.setItem('userInfo',JSON.stringify(res.data))\r\n                // setCurrentUsername(res.data.currentUsername)\r\n                history.push('/home')\r\n            }\r\n        } catch (e) {\r\n            // console.log(e.response)\r\n        alert(e.response.data.msg.toString())\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"title\"><span>登录页面</span></div>\r\n            <h2 className=\"login_nav\">用户登录</h2>\r\n            <form className=\"login_form\" onSubmit={submit}>\r\n                <div className=\"login_form_item\"><div>用户名：</div><div><input className=\"login_form_input\" ref={usernameRef} type=\"text\" /></div></div>\r\n                <div className=\"login_form_item\"><div>密码：</div><div><input className=\"login_form_input\" ref={passwordRef} type=\"password\" /></div></div>\r\n                {/* <img src=\"http://localhost:8080/captcha\" alt=\"注册码\" /> <br/> */}\r\n                {/* Captcha:  <input ref={captchaRef}  type=\"text\" /><br /> */}\r\n                <button className=\"finish_btn\">登录</button>\r\n                <Link to=\"/register\"><button className=\"finish_btn\">前往注册</button></Link>\r\n                <section className=\"login_form_item login_tip\">\r\n                tips: 本demo可用<i>用户名: lily, 密码: 123456</i>或<br/><i>用户名: haha, 密码: 213213</i>直接登录.\r\n                也可以注册尝试\r\n                </section>\r\n            </form>\r\n\r\n            {/* <Link to=\"/forget\" >忘记密码?</Link> */}\r\n\r\n\r\n        </div>\r\n    )\r\n}\r\n","const Url = \"http://localhost:8080/\"\r\nexport default Url\r\n","import React from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport \"./Create.scss\"\r\nimport url from './url.js'\r\nexport default function Create() {\r\n    return (\r\n        <div className=\"create_content\">\r\n            <div className=\"create_item\">\r\n                    <img src={`${url}static/vote1.png`} alt=\"vote1\"/>\r\n\r\n                    <Link to=\"/create-vote\">\r\n                        <div className=\"create_item_btn\">\r\n                        创建单选\r\n                        </div>\r\n                    </Link>\r\n            </div>\r\n            <div className=\"create_item\">\r\n                    <img src={`${url}static/vote2.png`} alt=\"vote2\"/>\r\n                    <Link to=\"/create-vote?multiple=1\">\r\n                        <div className=\"create_item_btn\">\r\n                        创建多选\r\n                        </div>\r\n                    </Link>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","import React, { useEffect, useState } from 'react'\r\nimport axios from 'axios'\r\nimport { useHistory, Link } from 'react-router-dom'\r\nimport './My.scss'\r\n\r\nexport default function My({userInfo ,setUserInfo}) {\r\n    // console.log('My中的用户信息',userInfo)\r\n    var localStorage = window.localStorage\r\n    var history = useHistory()\r\n    var [myVotes, setMyVotes] = useState([])\r\n    // 登出页面\r\n    function logout() {\r\n        axios.get('/logout').then(() => {\r\n            // history.push('/login')\r\n            setUserInfo(null)\r\n        })\r\n        localStorage.clear()\r\n        history.push('/login')\r\n    }\r\n\r\n    useEffect(() => {\r\n        async function getVotes() {\r\n            let res = await axios.get('/myvotes')\r\n            setMyVotes(res.data)\r\n        }\r\n        getVotes()\r\n    }, [])\r\n\r\n    // 删除投票\r\n    async function deleteMyvote(voteId) {\r\n        var res = await axios.post('/delete-vote', {\r\n            voteId\r\n        })\r\n        setMyVotes(res.data)\r\n    }\r\n    return (\r\n\r\n        <div>\r\n            <ul>\r\n                {\r\n                myVotes.map((vote, idx) => {\r\n                    // 判断是否过期\r\n                    let voteDeadline = new Date(vote.deadline)\r\n                    let isOverdue = (voteDeadline < Date.now()) ? true : false\r\n                    // console.log('帖子id：', vote.id, '用户id：', userInfo.id)\r\n                    return <li className=\"create_vote_list myvote_list\" key={idx}>\r\n                        <Link className=\"vote_link\" to={`/vote/${vote.id}`}>\r\n                            <span>{vote.title}</span>\r\n                            { isOverdue &&\r\n                                <span style={{color: 'rgba(230,0,18,0.4)',fontSize: '14px'}}>(已过期)</span>\r\n                            }\r\n                        </Link>\r\n                        { userInfo && vote && (vote.userId === userInfo.id) &&\r\n                            <button className=\"delete_vote\" onClick={() => deleteMyvote(vote.id)}>删除</button>\r\n                            }\r\n                    </li>\r\n                })\r\n                }\r\n            </ul>\r\n            <button className=\"finish_btn\" onClick={logout}>登出</button>\r\n        </div>\r\n    )\r\n}\r\n","import React  from 'react'\r\nimport { Redirect, Route, useRouteMatch ,NavLink } from 'react-router-dom'\r\nimport Create from './Create.jsx'\r\nimport My from './My'\r\nimport './Home.scss'\r\nimport './iconfont.css'\r\n\r\nexport default function Home({userInfo, setUserInfo}) {\r\n    let { path, url} = useRouteMatch()\r\n    // console.log('用户信息：',userInfo)\r\n    return (\r\n        <div>\r\n            <div className=\"title\">VoteDemo</div>\r\n            <Route path={`${url}/`} exact >\r\n                <Redirect to={`${url}/create`} />\r\n            </Route>\r\n\r\n            <Route path={`${url}/create`} >\r\n                <Create />\r\n            </Route>\r\n            <Route path={`${url}/my`} >\r\n                <My userInfo={userInfo} setUserInfo={setUserInfo} />\r\n            </Route>\r\n            <div className=\"navbar\">\r\n                <div className=\"navbar_item\">\r\n                    <div>\r\n                        <NavLink activeClassName=\"active\" to={`${url}/create`}><i className=\"iconfont icon-xinjian1\"></i><br />新建</NavLink>\r\n                    </div>\r\n                </div>\r\n                <div className=\"navbar_item\">\r\n                    <div>\r\n                        <NavLink to={`${url}/my`}><i className=\"iconfont icon-wodedangxuan\"></i><br />我的</NavLink>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    )\r\n}\r\n","\r\nimport React from 'react'\r\nimport { useInput, useBoolean, useArray} from 'react-hanger'\r\nimport axios from 'axios'\r\nimport { useHistory, useLocation } from 'react-router-dom'\r\nimport 'antd/dist/antd.css';\r\nimport { Switch } from 'antd';\r\nimport './CreateVote.scss'\r\nimport './iconfont.css'\r\nfunction useQuery() {\r\n    return new URLSearchParams(useLocation().search);\r\n}\r\nexport default function CreateVote () {\r\n    var query = useQuery()\r\n    var history = useHistory()\r\n    var options = useArray(['',''])\r\n    var title  = useInput()\r\n    var desc = useInput()\r\n    var deadline = useInput()\r\n    var anonymous = useBoolean()\r\n    var isMultiple = useBoolean(query.get('multiple') == '1'? true : false)\r\n\r\n    // 返回函数\r\n    function goBack() {\r\n        history.goBack()\r\n    }\r\n\r\n    // 添加选项\r\n    function getMoreOption() {\r\n        options.push('')\r\n        isMultiple.setFalse()\r\n    }\r\n    function handleDeleteOption(idx) {\r\n        if(options.length == 2) {\r\n            return\r\n        }\r\n        options.removeIndex(idx)\r\n        if(options.length == 2) {\r\n            isMultiple.setTrue()\r\n        }\r\n    }\r\n    async function createVote() {\r\n        try {\r\n            await axios.post('/vote',{\r\n                title: title.value,\r\n                desc: desc.value,\r\n                options: options.value,\r\n                deadline: new Date(deadline.value).toISOString(),\r\n                anonymous: anonymous.value ? 1 : 0,\r\n                isMultiple: isMultiple.value ? 1 : 0,\r\n            })\r\n            alert('创建成功')\r\n            history.push('/home')\r\n        } catch (e) {\r\n            alert('创建失败')\r\n        }\r\n    }\r\n    return (\r\n        <div>\r\n            <div className=\"title\"><span><i onClick={goBack} className=\"iconfont icon-fanhui\"></i></span>&nbsp;创建投票</div>\r\n            <div className=\"createVote_content\">\r\n                <div><input className=\"vote_title\" value={title.value} onChange={title.onChange} type=\"text\" placeholder=\"投票标题\" /></div>\r\n                <div><input className=\"vote_item\" value={desc.value} onChange={desc.onChange} type=\"text\" placeholder=\"补充描述 [选填]\" /></div>\r\n                <ul className=\"vote_ul\">\r\n                    {\r\n                        options.value.map((it, idx) => {\r\n                            return <li className=\"create_vote_list\" key={idx}>\r\n                                <button className=\"create_vote_btn\" onClick={() => handleDeleteOption(idx)}><span>-</span></button>\r\n                                <input className=\"create_vote_text\" type=\"text\" value={it} onChange={(e) => options.setValue([...options.value.slice(0, idx), e.target.value, ...options.value.slice(idx + 1)])}/>\r\n                            </li>\r\n                        })\r\n                    }\r\n                </ul>\r\n                <div className=\"create_vote_list\" ><button className=\"create_vote_btn vote_add\" onClick={getMoreOption}><span>+</span></button><span>添加选项</span></div>\r\n                <div className=\"create_vote_list create_vote_space\">截止日期: <input className=\"deadline\" value={deadline.value} onChange={deadline.onChange} type=\"datetime-local\" /></div>\r\n                <div className=\"create_vote_list create_vote_select\"><div>匿名投票: </div><Switch className=\"switch_btn\" onChange={anonymous.toggle} checked={anonymous.checked}></Switch></div>\r\n                <div className=\"create_vote_list create_vote_select\"><div>多选: </div><Switch className=\"switch_btn\" checked={isMultiple.value} onChange={isMultiple.toggle}></Switch></div>\r\n            </div>\r\n            <div><button className=\"finish_btn\" onClick={createVote}>创建</button></div>\r\n        </div>\r\n    )\r\n}\r\n","import 'antd/dist/antd.css'\r\nimport Axios from 'axios'\r\nimport React, { useState, useEffect } from 'react'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport {groupBy} from 'lodash'\r\nimport {\r\n    ShareAltOutlined\r\n  } from '@ant-design/icons';\r\nimport './ViewVote.scss'\r\nimport './iconfont.css'\r\nimport url from './url.js'\r\n\r\nexport default function ViewVote({ userInfo }) {\r\n    // 替换url为wsUrl\r\n    var wsUrl = url.replace(/https?/, 'ws')\r\n    var history = useHistory()\r\n    var { id } = useParams()\r\n    var [loading, setLoading] = useState(true)\r\n    var [voteInfo, setVoteInfo] = useState(null)\r\n    // var [votings, setVotings] = useState(null)\r\n\r\n    // 返回按钮\r\n    function goBack() {\r\n        history.goBack()\r\n    }\r\n\r\n\r\n    if (!loading && voteInfo) {\r\n        var groupedVotings = groupBy(voteInfo.votings, 'optionId')\r\n        var uniqueUsersCount = new Set(voteInfo.votings.map(it => it.userId)).size\r\n    }\r\n    useEffect(() => {\r\n        async function fetchData() {\r\n            setVoteInfo(null)\r\n            setLoading(false)\r\n            await Axios.get(`/vote/${id}`).then((res) => {\r\n                setVoteInfo(res.data)\r\n                // setVotings(res.data.votings)\r\n                setLoading(false)\r\n            })\r\n        }\r\n        fetchData()\r\n    } ,[id])\r\n    useEffect(() => {\r\n        if(!voteInfo) {\r\n            return\r\n        }\r\n        // 用于接收某个vote的新的选票信息的\r\n        if(Date.now() < new Date(voteInfo.deadline).getTime()) {\r\n            var ws = new WebSocket(`${wsUrl}/vote/${id}`)\r\n            ws.onmessage = e => {\r\n                var votings = JSON.parse(e.data)\r\n                setVoteInfo({\r\n                    ...voteInfo,\r\n                    votings\r\n                })\r\n            }\r\n        } else {\r\n            return\r\n        }\r\n        return () => ws.close()\r\n    }, [voteInfo])\r\n\r\n    // 点击投票系统\r\n    async function voteUp(optionId, hasVoted) {\r\n        // 已过截止日期\r\n        if(Date.now() > new Date(voteInfo.deadline).getTime()) {\r\n            return\r\n        }\r\n        // if (!hasVoted) {\r\n        //     var thisVoting = {\r\n        //         id: -1,\r\n        //         optionId: optionId,\r\n        //         voteId: id,\r\n        //         userId: userInfo.id,\r\n        //         avatar: userInfo.avatar,\r\n        //     }\r\n        //     setVotings([...votings,thisVoting])\r\n        // } else {\r\n        //     var filterVotings = votings.filter(it => {\r\n        //         return !(it.userId == userInfo.id && optionId == it.optionId)\r\n        //     })\r\n        //     setVotings(filterVotings)\r\n        // }\r\n        var res = await Axios.post(`/voteup/${id}`,{\r\n            optionId,\r\n            isVoteDown: hasVoted,\r\n        })\r\n        // setVoteInfo(res.data)\r\n    }\r\n\r\n    // 计算进度条\r\n    function calPCT(divisor, dividend) {\r\n        if(!dividend) {\r\n            return 0\r\n        } else {\r\n            return (100 * divisor / dividend).toFixed(2)\r\n        }\r\n    }\r\n\r\n\r\n\r\n    if(!voteInfo) {\r\n        return <div>loading...</div>\r\n    } else {\r\n        return (\r\n            <div >\r\n                <div className=\"title\"><i onClick={goBack} className=\"iconfont icon-fanhui\"></i>&nbsp;投票结果</div>\r\n                <div className=\"voteInfo_title\"><h2>{voteInfo.title}</h2><div><ShareAltOutlined /></div>\r\n                </div>\r\n                <p className=\"voteInfo_desc\">{voteInfo.desc? voteInfo.desc: '空'}<span>{voteInfo.isMultiple ? '[单选]' : '[多选]'}</span></p>\r\n                <ul>\r\n                    {\r\n                        voteInfo.options.map((option) => {\r\n                            var userId = option.userId // 这个选项是哪个用户投的\r\n                            var currVotings = groupedVotings[option.id] ? groupedVotings[option.id] : [] //当前选项的所有投票\r\n                            var hasCurrentVote = currVotings.find(it => it.userId === userInfo.id) ? true : false\r\n                            return <li className=\"voteInfo_content\" key={option.id} onClick={() => voteUp(option.id, hasCurrentVote)}>\r\n                                {/* <input type=\"checkbox\" className=\"checkbox_item\" onChange={() => voteUp(option.id, hasCurrentVote)} checked={hasCurrentVote} /> */}\r\n                                <span className=\"option-text\">{option.content}</span>\r\n                                {' '}\r\n                                { hasCurrentVote &&\r\n                                    <i className=\"iconfont icon-gou\"></i>}\r\n\r\n                                <strong> {currVotings.length} 票 {'  '} {calPCT(currVotings.length, uniqueUsersCount)}%</strong>\r\n                                <div className=\"option-ratio\" style={{width: calPCT(currVotings.length, uniqueUsersCount)+'%'}} ></div>\r\n                                <ul className=\"avatars\">\r\n                                    {\r\n                                        currVotings.map((voting, idx) => {\r\n                                            return <li key={idx}><img className=\"avatar\" src={voting.avatar}></img></li>\r\n                                        })\r\n                                    }\r\n                                </ul>\r\n                            </li>\r\n                        })\r\n                    }\r\n                </ul>\r\n                <p className=\"deadline_tip\">投票截至：{new Date(voteInfo.deadline).toLocaleString()}</p>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n","import React, { useRef, useEffect, useState } from 'react'\r\nimport { useHistory } from 'react-router-dom'\r\nimport axios from 'axios'\r\nimport {\r\n    BrowserRouter as Router,\r\n    Switch,\r\n    Route,\r\n    Link,\r\n    Redirect,\r\n    useParams,\r\n    withRouter,\r\n    useRouteMatch,\r\n    HashRouter,\r\n  } from \"react-router-dom\";\r\nimport './Login.scss'\r\n\r\nexport default function() {\r\n\r\n    const mystorage = window.localStorage\r\n    const [currentUsername, setCurrentUsername] = useState('')\r\n    // useEffect(()=> {\r\n    //     var localUserInfo = mystorage.userInfo ? JSON.parse(mystorage.userInfo): ''\r\n    //     setCurrentUsername(localUserInfo.username)\r\n    // },[currentUsername])\r\n    const usernameRef = useRef()\r\n    const passwordRef = useRef()\r\n    // const captchaRef = useRef()\r\n    const history = useHistory()\r\n\r\n\r\n    async function submit(e) {\r\n        e.preventDefault()\r\n        var data = {\r\n            name: usernameRef.current.value,\r\n            password: passwordRef.current.value,\r\n            // captcha: captchaRef.current.value,\r\n        }\r\n        try {\r\n            var res = await axios.post('/register', data)\r\n            if (res.data.code != -1) {\r\n                // console.log(res.data)\r\n                alert('注册成功')\r\n                // props.onLogin && props.onLogin(res.data)\r\n                // mystorage.setItem('userInfo',JSON.stringify(res.data))\r\n                setCurrentUsername(res.data.currentUsername)\r\n                history.push('/login')\r\n            }\r\n        } catch (e) {\r\n            // console.log(e.response)\r\n        alert(e.response.data.msg.toString())\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"title\"><span>注册页面</span></div>\r\n            <h2 className=\"login_nav\">用户注册</h2>\r\n            <form className=\"login_form\" onSubmit={submit}>\r\n                <div className=\"login_form_item\"><div>用户名：</div><div><input className=\"login_form_input\" ref={usernameRef} type=\"text\" /></div></div>\r\n                <div className=\"login_form_item\"><div>密码：</div><div><input className=\"login_form_input\" ref={passwordRef} type=\"password\" /></div></div>\r\n                {/* <img src=\"http://localhost:8080/captcha\" alt=\"注册码\" /> <br/> */}\r\n                {/* Captcha:  <input ref={captchaRef}  type=\"text\" /><br /> */}\r\n                <button className=\"finish_btn\">注册</button>\r\n                <Link to=\"/login\"><button className=\"finish_btn\">返回登录</button></Link>\r\n            </form>\r\n            {/* <Link to=\"/forget\" >忘记密码?</Link> */}\r\n\r\n\r\n        </div>\r\n    )\r\n}\r\n","import React, { useEffect, useState } from 'react';\nimport './App.css';\nimport {\n  Redirect,\n  Route,\n  Switch,\n  useHistory\n} from 'react-router-dom'\nimport axios from 'axios'\nimport Login from './Login.jsx'\nimport Home from './Home.jsx'\nimport CreateVote from './CreateVote'\nimport ViewVote from './ViewVote.jsx'\nimport Register from './Register.jsx'\nimport url from './url'\n\nfunction App() {\n  var history = useHistory()\n  var [userInfo, setUserInfo] = useState(undefined)\n  window.setUserInfo = setUserInfo\n  console.log(url)\n  useEffect(() => {\n    //  进入页面时发送一个验证信息判断是否登录\n    axios.get('/userInfo').then(res => {\n      window.user = res.data\n      console.log('userInfo', res.data)\n      setUserInfo(res.data)\n    })\n  },[])\n\n  // 如果未登录直接跳转到登录界面\n  if(!userInfo) {\n    history.push('/login')\n  }\n\n  return (\n      <div className=\"App\">\n        <Switch>\n          <Route path=\"/\" exact>\n            <Redirect to=\"/home\" />\n          </Route>\n          <Route path=\"/login\">\n            <Login setUserInfo={setUserInfo} userInfo={userInfo}/>\n          </Route>\n          <Route path=\"/register\">\n            <Register />\n          </Route>\n          <Route path=\"/home\">\n            <Home userInfo={userInfo} setUserInfo={setUserInfo} />\n          </Route>\n          <Route path=\"/create-vote\" >\n            <CreateVote />\n          </Route>\n          <Route path=\"/vote/:id\" >\n            {userInfo &&\n              <ViewVote userInfo={userInfo} />\n            }\n          </Route>\n        </Switch>\n      </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport { HashRouter } from 'react-router-dom'\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n    <App />\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}